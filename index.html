<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>Solix AI Assistant</title>
<link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet" />
<style>
  :root {
    --primary: #ffd100;
    --bg: #f1f3f4;
    --bot-bg: #fff;
    --user-bg: #fff8e1;
    --text-main: #172b4d;
    --text-sub: #6b778c;
    --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    --radius-lg: 16px;
    --radius-sm: 8px;
    --shadow: 0 10px 40px rgba(0,0,0,0.15);
  }
  html, body {
    margin: 0; padding: 0; width: 100%; height: 100%;
    background: var(--bg);
    font-family: var(--font-family);
    overscroll-behavior: none;
    overflow: hidden;
  }
  #chatbot {
    position: fixed;
    right: 20px; bottom: 20px;
    width: 420px; max-width: 100vw;
    height: 600px; max-height: 90vh;
    background: var(--bg);
    box-shadow: var(--shadow);
    border-radius: var(--radius-lg);
    display: flex; flex-direction: column; z-index: 9999;
  }
  @media (max-width: 480px) {
    #chatbot {
      width: 100vw; height: 80vh;
      right: 0; bottom: 0;
      border-radius: 0;
      box-shadow: none;
    }
  }
  #header {
    background: var(--primary);
    color: var(--text-main);
    padding: 14px 20px;
    display: flex;
    align-items: center;
    gap: 12px;
    user-select: none;
    flex-shrink: 0;
  }
  #avatar {
    width: 44px; height: 44px;
    background: rgba(0,0,0,0.1);
    border-radius: 50%;
    font-weight: 700;
    font-size: 24px;
    display: flex;
    justify-content: center;
    align-items: center;
    color: var(--text-main);
    flex-shrink: 0;
  }
  #title {
    font-weight: 700;
    font-size: 20px;
    margin: 0;
  }
  #messages {
    flex-grow: 1;
    padding: 18px 20px;
    background: var(--bg);
    display: flex;
    flex-direction: column;
    gap: 12px;
    overflow-y: auto;
    scroll-behavior: smooth;
    overscroll-behavior: contain;
    text-align: left;
  }
  .message {
    max-width: 90%;
    display: flex;
    flex-direction: column;
    gap: 6px;
    animation: fadein 0.3s ease forwards;
    opacity: 0;
    transform: translateY(10px);
    text-align: left;
  }
  @keyframes fadein {
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }
  .bot {
    align-self: flex-start;
  }
  .user {
    align-self: flex-end;
  }
  .avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: inline-flex;
    justify-content: center;
    align-items: center;
    font-weight: 700;
    font-size: 18px;
    user-select: none;
    margin-right: 8px;
  }
  .avatar.bot {
    background: var(--primary);
    color: var(--text-main);
  }
  .bubble {
    padding: 12px 18px;
    border-radius: var(--radius-lg);
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    word-break: break-word;
    white-space: pre-wrap;
    user-select: text;
    background: var(--bot-bg);
    color: var(--text-main);
    border-bottom-left-radius: var(--radius-sm);
    border-top-left-radius: var(--radius-lg);
    border-top-right-radius: var(--radius-lg);
    text-align: left;
  }
  .user .bubble {
    background: var(--user-bg);
    border-bottom-right-radius: var(--radius-sm);
    border-top-left-radius: var(--radius-lg);
    border-top-right-radius: var(--radius-lg);
    font-weight: 600;
    text-align: left;
  }
  .timestamp {
    font-size: 11px;
    color: var(--text-sub);
    user-select: none;
    white-space: nowrap;
    padding-left: 44px;
  }
  .user .timestamp {
    padding-left: 0;
    padding-right: 44px;
    text-align: right;
  }
  .chips {
    margin-top: 8px;
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }
  button.chip {
    background: var(--user-bg);
    border: none;
    border-radius: 20px;
    padding: 6px 14px;
    font-weight: 600;
    color: var(--text-main);
    cursor: pointer;
    user-select: none;
    white-space: nowrap;
    transition: background-color 0.3s ease;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    font-size: 14px;
  }
  button.chip:hover {
    background: var(--primary);
    color: var(--text-main);
  }
  button.chip:disabled {
    opacity: 0.6;
    cursor: default;
    box-shadow: none;
  }
  #input-area {
    padding: 14px 20px;
    background: #fff;
    border-top: 1px solid #dde1e6;
    flex-shrink: 0;
  }
  form {
    display: flex;
    gap: 12px;
  }
  input[type="text"] {
    flex-grow: 1;
    font-size: 14px;
    padding: 12px 18px;
    border-radius: 20px;
    border: 1px solid #ccc;
    color: var(--text-main);
    font-family: var(--font-family);
    outline: none;
    transition: border-color 0.25s ease;
  }
  input[type="text"]:focus {
    border-color: var(--primary);
    box-shadow: 0 0 8px rgba(255,209,0,0.6);
  }
  input::placeholder {
    color: var(--text-sub);
    font-weight: 400;
  }
  button#send-button {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: var(--primary);
    border: none;
    font-weight: 700;
    font-size: 20px;
    color: var(--text-main);
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    user-select: none;
    transition: background-color 0.2s ease;
  }
  button#send-button:disabled {
    opacity: 0.6;
    cursor: default;
    background: #ccc;
    color: #888;
  }
  button#send-button:not(:disabled):hover {
    background: #d4b300;
  }
  a.contact-link {
    color: var(--primary);
    text-decoration: underline;
    user-select: auto;
  }
  a.contact-link:hover {
    color: #d4b300;
  }
  a.calendly-link {
    display: inline-block;
    padding: 8px 18px;
    margin-top: 8px;
    background: var(--primary);
    color: var(--text-main);
    font-weight: 600;
    text-decoration: none;
    border-radius: var(--radius-sm);
    user-select: auto;
    transition: background-color 0.2s ease;
  }
  a.calendly-link:hover {
    background-color: #d4b300;
  }
  .typing-indicator {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 2px 6px;
  }
  .typing-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--text-sub);
    animation: bounce 1.4s infinite ease-in-out;
  }
  .typing-dot:nth-child(1) { animation-delay: 0; }
  .typing-dot:nth-child(2) { animation-delay: 0.2s; }
  .typing-dot:nth-child(3) { animation-delay: 0.4s; }
  @keyframes bounce {
    0%, 80%, 100% { transform: scale(0); }
    40% { transform: scale(1); }
  }
</style>
</head>
<body>
<div id="chatbot-container" role="region" aria-label="Solix AI Assistant chatbot">
  <header id="chat-header">
    <div id="header-avatar" aria-hidden="true">S</div>
    <h1 id="chat-title">Solix AI Assistant</h1>
  </header>
  <main id="chat-messages" aria-live="polite" aria-atomic="false"></main>
  <section id="input-area">
    <form id="chat-form" aria-label="Chat input form">
      <input id="user-input" type="text" aria-label="Message input" placeholder="Ask something about Coen's expertise or services..." autocomplete="off" required />
      <button type="submit" id="send-button" aria-label="Send message" disabled>âž¤</button>
    </form>
  </section>
</div>

<script src="https://assets.calendly.com/assets/external/widget.js" async></script>
<script>
  (function() {
    const translations = {
      en: {
        title: "Solix AI Assistant",
        placeholder: "Ask something about Coen's expertise or services...",
        welcome: {
          text: "Hello! I'm Coen Zweers' AI assistant. You can ask about skills, projects, certifications, and services. How can I help you?",
          chips: [
            "Tell me about Coen's services",
            "Describe Coen's product owner experience",
            "Tell me about Coen's agile and Scrum expertise",
            "List Coen's key projects",
            "Book a call",
            "Contact Coen"
          ],
          langSwitcher: { lang: "nl", text: "ðŸ‡³ðŸ‡± Switch to Dutch" }
        },
        intents: [
          {id: "services", keywords: ["service", "offer", "help", "what do you do"], response: {text:
            `Coen Zweers offers consultancy in renewable energy, finance, and technology.
             Main services: strategic consultancy, interim management, agile coaching, product ownership, project management.
             Feel free to ask more or book a call.`, chips: ["Tell me about Coen's product owner experience", "Book a call"]}},
          {id: "product_owner", keywords: ["product owner", "product manager", "backlog", "jira", "figma", "pspo"], response: {text:
            `Coen has extensive experience as Product Owner at Sunrock and Rabobank.
             Leads product backlog, manages Jira, designs in Figma.
             Certified Professional Scrum Product Owner (PSPO II).`, chips: ["Tell me about Coen's agile coaching", "Book a call"]}},
          {id: "agile", keywords: ["agile", "scrum", "scrum master", "psm", "coach"], response: {text:
            `Coen is an Agile Coach and Scrum Master at ABN AMRO.
             Coached 25 team members in Scrum practices.
             Certified PSM II and SAFe Agilist.`, chips: ["Tell me about Coen's product owner experience", "Book a call"]}},
          {id: "projects", keywords: ["project", "elipslife", "erp", "kramp", "sunrock", "rabobank", "accenture"], response: {text:
            `Coen's project highlights:
             - ERP implementation at elipsLife in 4 countries.
             - Transformation PMO at Kramp.
             - Digital solar energy solutions at Sunrock.
             - AI and automation projects at Rabobank and Accenture.`, chips: ["More about elipsLife", "More about Sunrock", "Book a call"]}},
          {id: "contact", keywords: ["contact", "call", "book", "schedule", "appointment", "talk", "meeting"], response: {text:
            `Schedule an introductory call here: <a href="https://calendly.com/coenzers-solix/introduction" target="_blank" rel="noopener" class="calendly-link" aria-label="Schedule call">Book a call</a><br> Or email: <a href="mailto:coenzers@solix.cc" class="contact-link">coenzers@solix.cc</a>`, chips: []}},
          {id: "thanks", keywords: ["thanks", "thank you", "gracias", "ty"], response: {text:
            `You're welcome! Feel free to ask anything else or book a call.`, chips: ["Tell me about Coen's services", "Book a call"]}}
        ],
        fallback: {
          generic: {
            text: `Sorry, I donâ€™t have the answer. You can <a href="https://calendly.com/coenzers-solix/introduction" target="_blank" class="calendly-link">book a call</a> or email <a href="mailto:coenzers@solix.cc" class="contact-link">coenzers@solix.cc</a>.`,
            chips: ["Tell me about Coen's services", "Book a call"]
          }
        }
      },
      nl: {
        title: "Solix AI Assistent",
        placeholder: "Vraag over Coens ervaring, projecten of diensten...",
        welcome: {
          text:"Hallo! Ik ben de AI-assistent van Coen Zweers. Stel vragen over zijn ervaring, certificeringen en diensten.",
          chips:[
            "Vertel over Coens diensten",
            "Vertel over Coens Product Owner ervaring",
            "Vertel over Coens agile en Scrum ervaring",
            "Noem Coens belangrijkste projecten",
            "Plan een gesprek",
            "Contacteer Coen"
          ],
          langSwitcher: { lang: "en", text: "ðŸ‡¬ðŸ‡§ Switch to English" }
        },
        intents: [
          {id: "services", keywords: ["dienst", "aanbod", "hulp", "wat doe je"], response: {text:
            `Coen Zweers biedt consultancy in energie, financiÃ«n en technologie.
             Belangrijkste diensten: strategisch advies, interim management, agile coaching, producteigenaarschap, projectmanagement.
             Stel gerust meer vragen of plan een gesprek.`, chips: ["Vertel over Coens Product Owner ervaring", "Plan een gesprek"]}},
          {id: "product_owner", keywords: ["product owner", "productmanager", "backlog", "jira", "figma", "pspo"], response: {text:
            `Coen heeft ruime ervaring als Product Owner bij Sunrock en Rabobank.
             Leidt productbacklog, beheert Jira, ontwerpt met Figma.
             Gecertificeerd Professional Scrum Product Owner (PSPO II).`, chips: ["Vertel over Coens agile coaching", "Plan een gesprek"]}},
          {id: "agile", keywords: ["agile", "scrum", "scrum master", "coach", "psm"], response: {text:
            `Coen is Agile Coach en Scrum Master bij ABN AMRO.
             Coacht 25 teamleden en heeft jaren ervaring met Scrum.
             Gecertificeerd PSM II en SAFe Agilist.`, chips: ["Vertel over Coens Product Owner ervaring", "Plan een gesprek"]}},
          {id: "projects", keywords: ["project", "elipslife", "erp", "kramp", "sunrock", "rabobank", "accenture"], response: {text:
            `Belangrijkste projecten van Coen:
             - ERP implementatie bij elipsLife in 4 landen
             - Transformatie PMO bij Kramp
             - Digitale oplossingen zonne-energie Sunrock
             - AI en automatisering Rabobank & Accenture`, chips: ["Meer over elipsLife", "Meer over Sunrock", "Plan een gesprek"]}},
          {id: "contact", keywords: ["contact", "gesprek", "afspraak", "plan", "boek", "bel", "kennismaking"], response: {text:
             `Maak een afspraak via: <a href="https://calendly.com/coenzers-solix/introduction" target="_blank" rel="noopener" class="calendly-link" aria-label="Plan een gesprek">Plan een gesprek</a><br> Of e-mail: <a href="mailto:coenzers@solix.cc" class="contact-link">coenzers@solix.cc</a>`, chips: []}},
          {id: "thanks", keywords: ["dank", "bedankt", "super", "top"], response: {text:
             `Graag gedaan! Stel gerust meer vragen of plan een gesprek.`, chips: ["Vertel over Coens diensten", "Plan een gesprek"]}}
        ],
        fallback: {
          generic: {
            text: `Sorry, ik heb het antwoord niet. Plan een gesprek via <a href="https://calendly.com/coenzers-solix/introduction" class="calendly-link" target="_blank" rel="noopener">deze link</a> of mail naar <a href="mailto:coenzers@solix.cc" class="contact-link">coenzers@solix.cc</a>.`,
            chips: ["Vertel over Coens diensten", "Plan een gesprek"]
          }
        }
      }
    };

    const chatMessages = document.getElementById("chat-messages");
    const chatForm = document.getElementById("chat-form");
    const userInput = document.getElementById("user-input");
    const chatTitle = document.getElementById("chat-title");
    const sendButton = document.getElementById("send-button");

    let currentLanguage = navigator.language.startsWith("nl") ? "nl" : "en";

    function escapeHTML(text) {
      return text.replace(/[&<>"']/g, c => ({
        "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;"
      })[c]);
    }

    function setLanguage(lang) {
      currentLanguage = lang;
      const T = translations[lang];
      chatTitle.textContent = T.title;
      userInput.placeholder = T.placeholder;
      chatMessages.innerHTML = "";
      appendMessage("bot", T.welcome);
    }

    function matchIntent(text) {
      const lc = text.toLowerCase();
      const T = translations[currentLanguage];
      for (const intent of T.intents) {
        if (intent.keywords.some(k => lc.includes(k))) {
          return intent;
        }
      }
      for (const redirect of T.fallback?.topicRedirects || []) {
        if (redirect.topics.some(t => lc.includes(t))) {
          return T.intents.find(i => i.id === redirect.intentId);
        }
      }
      return null;
    }

    function getResponse(text) {
      let intent = matchIntent(text);
      const T = translations[currentLanguage];
      if (intent) {
        return {...intent.response, chips: intent.chips || []};
      }
      return T.fallback.generic;
    }

    function appendMessage(sender, message) {
      const wrapper = document.createElement("div");
      wrapper.className = `message-wrapper ${sender === "bot" ? "bot-wrapper" : "user-wrapper"}`;
      wrapper.style.textAlign = "left";

      const avatarHTML = sender === "bot" ? `<div class="bot-avatar" aria-hidden="true">S</div>` : "";
      const container = document.createElement("div");
      container.className = "message-container";

      if (message.text) {
        const msgEl = document.createElement("div");
        msgEl.className = sender === "bot" ? "message-content bot-content" : "message-content user-content";
        msgEl.innerHTML = message.text;
        container.appendChild(msgEl);
      }
      if (message.chips && message.chips.length) {
        const chipsDiv = document.createElement("div");
        chipsDiv.className = "suggestions";
        message.chips.forEach(chipText => {
          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = "chip";
          btn.textContent = chipText;
          btn.onclick = () => {
            appendMessage("user", { text: escapeHTML(chipText) });
            if (/email|mail/i.test(chipText)) {
              const emailMsg = currentLanguage === "nl" ?
                `Je kunt Coen bereiken via <a href="mailto:coenzers@solix.cc" class="contact-link">coenzers@solix.cc</a>.` :
                `You can email Coen at <a href="mailto:coenzers@solix.cc" class="contact-link">coenzers@solix.cc</a>.`;
              appendMessage("bot", { text: emailMsg });
            } else if (/book|plan|call/i.test(chipText)) {
              const bookedMsg = currentLanguage === "nl" ?
                `Plan een introductiegesprek via <a href="https://calendly.com/coenzers-solix/introduction" target="_blank" rel="noopener noreferrer" class="calendly-link" aria-label="Plan gesprek met Coen">deze link</a>.` :
                `Schedule an intro call via <a href="https://calendly.com/coenzers-solix/introduction" target="_blank" rel="noopener noreferrer" class="calendly-link" aria-label="Schedule call with Coen">this link</a>.`;
              appendMessage("bot", { text: bookedMsg });
            } else {
              handleBotResponse(chipText);
            }
          };
          chipsDiv.appendChild(btn);
        });
        container.appendChild(chipsDiv);
      }
      if (message.langSwitcher) {
        const langDiv = document.createElement("div");
        langDiv.className = "language-switcher";
        const langSwitchBtn = document.createElement("button");
        langSwitchBtn.className = "lang-chip";
        langSwitchBtn.type = "button";
        langSwitchBtn.textContent = message.langSwitcher.text;
        langSwitchBtn.onclick = () => setLanguage(message.langSwitcher.lang);
        langDiv.appendChild(langSwitchBtn);
        container.appendChild(langDiv);
      }
      const time = document.createElement("time");
      time.className = "timestamp";
      time.setAttribute("datetime", new Date().toISOString());
      time.textContent = new Date().toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
      container.appendChild(time);

      wrapper.innerHTML = avatarHTML;
      wrapper.appendChild(container);
      chatMessages.appendChild(wrapper);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function showTyping() {
      const typingHtml = `
        <div class="message-wrapper bot-wrapper" id="typing-indicator" aria-live="polite" aria-atomic="true">
          <div class="bot-avatar" aria-hidden="true">S</div>
          <div class="message-container">
            <div class="message-content bot-content" aria-label="AI Assistant is typing">
              <div class="typing-indicator">
                <span class="typing-dot"></span>
                <span class="typing-dot"></span>
                <span class="typing-dot"></span>
              </div>
            </div>
          </div>
        </div>`;
      chatMessages.insertAdjacentHTML("beforeend", typingHtml);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function removeTyping() {
      const typingInd = document.getElementById("typing-indicator");
      if (typingInd) typingInd.remove();
    }

    function handleBotResponse(text) {
      showTyping();
      setTimeout(() => {
        removeTyping();
        const response = getResponse(text);
        appendMessage("bot", response);
      }, 1200);
    }

    userInput.addEventListener("input", () => {
      sendButton.disabled = userInput.value.trim() === "";
    });

    chatForm.addEventListener("submit", e => {
      e.preventDefault();
      const val = userInput.value.trim();
      if (!val) return;
      appendMessage("user", { text: escapeHTML(val) });
      userInput.value = "";
      sendButton.disabled = true;
      handleBotResponse(val);
    });

    window.onload = () => {
      setLanguage(currentLanguage);
      userInput.focus();
    };
</script>
</body>
</html>
