<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
    <title>Solix.cc | AI Assistant</title>
    <style>
        /* CSS is unchanged from the previous version */
        :root {
            --primary-color: #ffd100; --secondary-color: #f1f3f4; --bot-message-bg: #ffffff;
            --user-message-bg: #fff8e1; --font-color: #172b4d; --font-color-light: #6b778c;
            --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            --border-radius-lg: 16px; --border-radius-sm: 8px;
        }
        html, body {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; font-family: var(--font-family); background-color: transparent;
        }
        #chatbot-container {
            width: 100%; height: 100%; background-color: var(--secondary-color);
            display: flex; flex-direction: column; overflow: hidden;
        }
        @media (min-width: 768px) {
            body { display: flex; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box; }
            #chatbot-container { max-width: 480px; height: 85%; max-height: 750px; border-radius: var(--border-radius-lg); box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2); }
        }
        #chat-header { background-color: var(--primary-color); color: var(--font-color); padding: 16px 20px; display: flex; align-items: center; flex-shrink: 0; gap: 12px; }
        #header-avatar { width: 40px; height: 40px; border-radius: 50%; background-color: rgba(0, 0, 0, 0.1); display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 20px; }
        #chat-header h3 { margin: 0; font-size: 18px; font-weight: 600; }
        #chat-messages { flex-grow: 1; padding: 20px; overflow-y: auto; min-height: 0; }
        .message-wrapper { display: flex; margin-bottom: 20px; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .bot-message-wrapper { justify-content: flex-start; }
        .user-message-wrapper { justify-content: flex-end; }
        .bot-avatar { width: 32px; height: 32px; border-radius: 50%; background-color: var(--primary-color); color: var(--font-color); display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 16px; margin-right: 12px; flex-shrink: 0; }
        .message-content { padding: 12px 16px; border-radius: var(--border-radius-lg); line-height: 1.5; word-wrap: break-word; max-width: 100%; }
        .calendly-embed-container { margin-top: 10px; border-radius: var(--border-radius-lg); overflow: hidden; }
        .message-container { display: flex; flex-direction: column; max-width: calc(100% - 44px); }
        .bot-message-wrapper .message-container { align-items: flex-start; }
        .user-message-wrapper .message-container { align-items: flex-end; max-width: 85%; }
        .bot-message-content { background-color: var(--bot-message-bg); color: var(--font-color); border-bottom-left-radius: var(--border-radius-sm); }
        .user-message-content { background-color: var(--user-message-bg); color: var(--font-color); border-bottom-right-radius: var(--border-radius-sm); }
        .message-time { font-size: 11px; color: var(--font-color-light); margin-top: 6px; padding: 0 5px; }
        .typing-indicator span { height: 8px; width: 8px; margin: 0 2px; background-color: #b0b8c8; border-radius: 50%; display: inline-block; animation: bounce 1.4s infinite ease-in-out both; }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }
        #chat-input-container { border-top: 1px solid #dde1e6; padding: 15px 20px; background-color: white; flex-shrink: 0; }
        #chat-input-form { display: flex; align-items: center; }
        #user-input { flex-grow: 1; border: 1px solid #ccc; border-radius: 20px; padding: 10px 18px; font-size: 14px; margin-right: 10px; outline: none; transition: border-color 0.2s; }
        #user-input:focus { border-color: var(--primary-color); }
        #send-btn { background-color: var(--primary-color); color: var(--font-color); border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background-color 0.2s; flex-shrink: 0; }
        #send-btn:hover { background-color: #e6b800; }
        .suggestion-chips, .language-switcher { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }
        .chip { background-color: #fff8e1; color: var(--font-color); padding: 6px 12px; border-radius: 16px; font-size: 13px; cursor: pointer; border: 1px solid transparent; transition: all 0.2s; }
        .chip:hover { border-color: var(--primary-color); background-color: #d1e3ff; }
        .lang-chip { background-color: transparent; color: var(--font-color-light); font-size: 12px; border: 1px solid #dde1e6; padding: 4px 10px; }
        .lang-chip:hover { background-color: #e9ecef; border-color: #b0b8c8;}
    </style>
</head>
<body>
    <div id="chatbot-container">
        <div id="chat-header"><div id="header-avatar">S</div><h3 id="chat-title">Solix AI Assistant</h3></div>
        <div id="chat-messages"></div>
        <div id="chat-input-container">
            <form id="chat-input-form">
                <input type="text" id="user-input" autocomplete="off"><button type="submit" id="send-btn">&#10148;</button>
            </form>
        </div>
    </div>
    <script type="text/javascript" src="https://assets.calendly.com/assets/external/widget.js" async></script>
    <script>
        window.addEventListener('load', () => {
            const chatInputForm = document.getElementById('chat-input-form');
            const userInput = document.getElementById('user-input');
            const chatMessages = document.getElementById('chat-messages');
            const chatTitle = document.getElementById('chat-title');

            let currentLanguage = navigator.language.startsWith('nl') ? 'nl' : 'en';

            const translations = {
                en: {
                    title: "Solix AI Assistant",
                    placeholder: "Ask about projects, skills, or services...",
                    welcome: {
                        text: `Hello! I'm the AI assistant for Coen Zweers. I can help you determine if his IT expertise is the right fit for your project. What would you like to know more about?`,
                        chips: ["Services Offered", "Past Projects & Experience", "Book an Introduction"],
                        langSwitcher: { lang: 'nl', text: 'ðŸ‡³ðŸ‡± Schakel over naar Nederlands' }
                    },
                    intents: [
                        { id: 'services_overview', keywords: ['service', 'offer', 'what you do', 'what do you do', 'capabilities', 'help with'], response: { text: `Great! Coen provides support across several key areas. To give you the most relevant information, are you looking for short-term strategic advice or a longer-term interim leadership role?`, chips: ["Strategic Advice", "Interim Leadership"] }},
                        { id: 'services_strategy', keywords: ['strategic advice', 'consultancy', 'strategy'], response: { text: `For strategic projects, Coen specializes in IT strategy, change management, and agile transformation workshops. He helps teams align on goals and execute effectively. Would you like to see a case study on this?`, chips: ["Yes, show a case study", "Book a Call"] }},
                        { id: 'services_interim', keywords: ['interim leadership', 'interim'], response: { text: `As an interim leader, Coen provides senior-level expertise to manage teams and ensure business continuity during critical projects or transitions. His work at elipsLife is a great example of this.`, chips: ["Tell me about elipsLife", "Book a Call"] }},
                        { id: 'experience_overview', keywords: ['experience', 'background', 'past project', 'work', 'history', 'case study', 'elipslife', 'resume'], response: { text: `At elipsLife, Coen served as interim Head of Business Services, leading a team of seven and managing a major international ERP implementation. This project unified teams across four countries and reduced financial reporting time by 60%. What other areas of his experience are you interested in?`, chips: ["Leadership Roles", "Product Management", "Book a Call"] }},
                        { id: 'contact', keywords: ['contact', 'book', 'call', 'introduction', 'schedule', 'meeting'], response: { text: `Based on our conversation, a brief 15-minute introductory call with Coen seems like the perfect next step. You can book a time that works for you directly below.`, htmlContent: `<div class="calendly-inline-widget" data-url="https://calendly.com/coenzweers-solix/introduction" style="min-width:320px;height:700px;"></div>`}},
                        { id: 'thanks', keywords: ['thanks', 'thank you', 'ok', 'great'], response: { text: "You're welcome! If you have any other questions, feel free to ask. Otherwise, booking a call is the best way to connect.", chips: ["Services", "Experience"] }}
                    ],
                    fallback: {
                        generic: { text: "My apologies, I'm not sure how to answer that. I am best at questions regarding Coen's services, professional experience, or booking a meeting.", chips: ["Services Offered", "Past Projects", "Book a Call"]},
                        topicRedirects: [
                            { topics: ['service', 'offer', 'capability', 'help'], intentId: 'services_overview' },
                            { topics: ['experience', 'work', 'history', 'project', 'case'], intentId: 'experience_overview' },
                            { topics: ['contact', 'book', 'call', 'schedule'], intentId: 'contact' }
                        ]
                    }
                },
                nl: {
                    title: "Solix AI Assistent",
                    placeholder: "Stel een vraag over projecten, skills, of diensten...",
                    welcome: {
                        text: `Hallo! Ik ben de AI assistent van Coen Zweers. Ik kan u helpen bepalen of zijn IT-expertise de juiste match is voor uw project. Waar wilt u meer over weten?`,
                        chips: ["Diensten", "Eerdere Projecten & Ervaring", "Plan een Kennismaking"],
                        langSwitcher: { lang: 'en', text: 'ðŸ‡¬ðŸ‡§ Switch to English' }
                    },
                    intents: [
                        { id: 'services_overview', keywords: ['diensten', 'aanbod', 'wat doe je', 'helpen', 'mogelijkheden'], response: { text: `Uitstekend! Coen ondersteunt op diverse kergebieden. Om u de beste informatie te geven, zoekt u strategisch advies voor de korte termijn, of een interim leiderschapsrol voor de langere termijn?`, chips: ["Strategisch Advies", "Interim Leiderschap"] }},
                        { id: 'services_strategy', keywords: ['strategisch advies', 'consultancy', 'strategie'], response: { text: `Voor strategische projecten is Coen gespecialiseerd in IT-strategie, verandermanagement en agile transformatie workshops. Hij helpt teams om doelen af te stemmen en effectief uit te voeren. Wilt u hier een case study van zien?`, chips: ["Ja, toon een case study", "Plan een Gesprek"] }},
                        { id: 'services_interim', keywords: ['interim leiderschap', 'interim'], response: { text: `Als interim leider biedt Coen senior expertise om teams te managen en bedrijfscontinuÃ¯teit te garanderen tijdens kritieke projecten of transities. Zijn werk bij elipsLife is hier een goed voorbeeld van.`, chips: ["Vertel over elipsLife", "Plan een Gesprek"] }},
                        { id: 'experience_overview', keywords: ['ervaring', 'achtergrond', 'project', 'werk', 'historie', 'case study', 'elipslife', 'cv'], response: { text: `Bij elipsLife was Coen interim Hoofd Business Services. Hij leidde een team van zeven en stuurde een grote, internationale ERP-implementatie aan. Dit project bracht teams uit vier landen samen en reduceerde de financiÃ«le rapportagetijd met 60%. In welke andere gebieden van zijn ervaring bent u geÃ¯nteresseerd?`, chips: ["Leiderschapsrollen", "Product Management", "Plan een Gesprek"] }},
                        { id: 'contact', keywords: ['contact', 'boek', 'boeken', 'gesprek', 'kennismaking', 'plannen', 'afspraak'], response: { text: `Op basis van ons gesprek lijkt een korte kennismaking van 15 minuten met Coen de perfecte volgende stap. U kunt hieronder direct een geschikt moment inplannen.`, htmlContent: `<div class="calendly-inline-widget" data-url="https://calendly.com/coenzweers-solix/introduction" style="min-width:320px;height:700px;"></div>`}},
                        { id: 'thanks', keywords: ['bedankt', 'dank', 'ok', 'geweldig'], response: { text: "Graag gedaan! Als u nog andere vragen heeft, stel ze gerust. Anders is het inplannen van een gesprek de beste manier om verder te praten.", chips: ["Diensten", "Ervaring"] }}
                    ],
                    fallback: {
                        generic: { text: "Mijn excuses, dat begrijp ik niet. Ik kan het beste helpen met vragen over diensten, ervaring en contactmogelijkheden.", chips: ["Diensten", "Ervaring", "Contact"] },
                        topicRedirects: [
                            { topics: ['dienst', 'aanbod', 'helpen'], intentId: 'services_overview' },
                            { topics: ['ervaring', 'werk', 'historie', 'project', 'case'], intentId: 'experience_overview' },
                            { topics: ['contact', 'boek', 'gesprek', 'afspraak'], intentId: 'contact' }
                        ]
                    }
                }
            };

            function setLanguage(lang) {
                currentLanguage = lang;
                const T = translations[lang];
                chatTitle.textContent = T.title;
                userInput.placeholder = T.placeholder;
                chatMessages.innerHTML = '';
                appendMessage('bot', T.welcome);
            }

            // --- IMPROVED: getBotResponse function with smarter fallback ---
            function getBotResponse(userText) {
                const text = userText.toLowerCase();
                const T = translations[currentLanguage];
                
                // 1. Primary Match: Try to find a specific intent
                for (const intent of T.intents) {
                    if (intent.keywords.some(keyword => text.includes(keyword))) {
                        return intent.response;
                    }
                }

                // 2. Secondary Match (Smart Fallback): If no specific match, look for broad topics
                for (const redirect of T.fallback.topicRedirects) {
                    if (redirect.topics.some(topic => text.includes(topic))) {
                        const matchedIntent = T.intents.find(intent => intent.id === redirect.intentId);
                        if (matchedIntent) {
                            return matchedIntent.response;
                        }
                    }
                }

                // 3. Final Fallback: If still no match, give the generic message
                return T.fallback.generic;
            }

            // --- All other functions (appendMessage, etc.) are unchanged ---
            chatInputForm.addEventListener('submit', (e) => { e.preventDefault(); const messageText = userInput.value.trim(); if (messageText) { appendMessage('user', { text: messageText }); userInput.value = ''; handleBotResponse(messageText); } });
            function handleBotResponse(userText) { showTypingIndicator(); setTimeout(() => { removeTypingIndicator(); const botResponse = getBotResponse(userText); appendMessage('bot', botResponse); }, 1200); }
            function appendMessage(sender, response) {
                const { text, chips = [], htmlContent = null, langSwitcher = null } = response;
                const messageWrapper = document.createElement('div'); messageWrapper.className = `message-wrapper ${sender}-message-wrapper`;
                let avatarHtml = ''; if (sender === 'bot') { avatarHtml = '<div class="bot-avatar">S</div>'; }
                const messageContainer = document.createElement('div'); messageContainer.className = 'message-container';
                if (text) { const messageContent = document.createElement('div'); messageContent.className = `message-content ${sender}-message-content`; messageContent.innerHTML = text; messageContainer.appendChild(messageContent); }
                if (htmlContent) { const embedContainer = document.createElement('div'); embedContainer.className = 'calendly-embed-container'; embedContainer.innerHTML = htmlContent; messageContainer.appendChild(embedContainer); }
                if (chips.length > 0) {
                    const chipsContainer = document.createElement('div'); chipsContainer.className = 'suggestion-chips';
                    chips.forEach(chipText => {
                        const chip = document.createElement('div'); chip.className = 'chip'; chip.textContent = chipText;
                        chip.onclick = () => { chipsContainer.querySelectorAll('.chip').forEach(c => c.style.pointerEvents = 'none'); chip.style.backgroundColor = 'var(--primary-color)'; chip.style.color = 'var(--font-color)'; appendMessage('user', { text: chipText }); handleBotResponse(chipText); };
                        chipsContainer.appendChild(chip);
                    });
                    messageContainer.appendChild(chipsContainer);
                }
                if (langSwitcher) { const langContainer = document.createElement('div'); langContainer.className = 'language-switcher'; const langChip = document.createElement('div'); langChip.className = 'chip lang-chip'; langChip.textContent = langSwitcher.text; langChip.onclick = () => setLanguage(langSwitcher.lang); langContainer.appendChild(langChip); messageContainer.appendChild(langContainer); }
                const messageTime = document.createElement('div'); messageTime.className = 'message-time'; messageTime.textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }); messageContainer.appendChild(messageTime);
                messageWrapper.innerHTML = avatarHtml; messageWrapper.appendChild(messageContainer);
                chatMessages.appendChild(messageWrapper); scrollToBottom();
            }
            function showTypingIndicator() { const indicatorHtml = `<div class="message-wrapper bot-message-wrapper" id="typing-indicator"><div class="bot-avatar">S</div><div class="message-container"><div class="message-content bot-message-content"><div class="typing-indicator"><span></span><span></span><span></span></div></div></div></div>`; chatMessages.insertAdjacentHTML('beforeend', indicatorHtml); scrollToBottom(); }
            function removeTypingIndicator() { const indicator = document.getElementById('typing-indicator'); if (indicator) indicator.remove(); }
            function scrollToBottom() { chatMessages.scrollTop = chatMessages.scrollHeight; }

            // Initialize the chat
            setLanguage(currentLanguage);
        });
    </script>
</body>
</html>
